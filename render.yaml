# ============================================================
# Render Blueprint - Market!N Wix Integration
# ============================================================
# This file defines the infrastructure for production
# Deploy using: Render Dashboard → New → Blueprint → Connect Repository
# Docs: https://render.com/docs/blueprint-spec
# ============================================================

services:
  # --------------------------
  # Production Environment
  # --------------------------
  - type: web
    name: marketin-wix-app
    runtime: node
    region: oregon
    plan: starter
    branch: main
    buildCommand: npm install && echo "=== Running Migrations ===" && npm run migrate:production && echo "=== Migrations Complete ==="
    startCommand: npm start
    healthCheckPath: /health
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: APP_URL
        sync: false  # Set manually in Render dashboard
      - key: WIX_CLIENT_ID
        sync: false
      - key: WIX_CLIENT_SECRET
        sync: false
      - key: WIX_REDIRECT_URI
        sync: false
      - key: WIX_PUBLIC_KEY
        sync: false
      - key: MARKETIN_API_KEY
        sync: false
      - key: MARKETIN_API_URL
        value: https://api.marketin.now/api/v1
      - key: DB_CLIENT
        value: pg
      - key: DATABASE_URL
        value: postgresql://marketin_wix_db_user:4zPt4FxxbDaN9DR95yUavm8qvfF0L4Et@dpg-d4oj2ua4d50c738u3li0-a.oregon-postgres.render.com:5432/marketin_wix_db?ssl=true
        sync: true  # Force Blueprint to override dashboard value
      - key: ENCRYPTION_KEY
        generateValue: true
      - key: SESSION_SECRET
        generateValue: true
      - key: ADMIN_API_KEY
        generateValue: true
      # Email alerts (optional)
      - key: SMTP_HOST
        sync: false
      - key: SMTP_PORT
        value: 587
      - key: SMTP_USER
        sync: false
      - key: SMTP_PASS
        sync: false
      - key: ALERT_EMAIL
        sync: false

# --------------------------
# Databases
# --------------------------
# NOTE: Database "marketin-wix-db" already exists as a separate service
# It will NOT be created by this blueprint
# Connect to it manually via DATABASE_URL environment variable
